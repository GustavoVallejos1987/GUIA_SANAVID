<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gesti√≥n de Prestadores</title>

  <!-- Bootstrap 5.3 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="estilos-prestadores.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="bg-light">

<!-- ‚úÖ VERIFICACI√ìN DE USUARIO -->
<script>
  const usuario = JSON.parse(localStorage.getItem('usuario'));
  if (!usuario) {
    alert("Debes iniciar sesi√≥n para acceder a esta p√°gina.");
    window.location.href = "login.html";
  }
</script>

<div class="container mt-5"> <!-- üëà ABRIR el contenedor principal aqu√≠ -->

  <!-- Encabezado y bot√≥n de cerrar sesi√≥n -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Gesti√≥n de Prestadores</h2>
    <div class="d-flex align-items-center gap-3">
      <h5 id="nombreUsuario" class="text-primary mb-0"></h5>
      <button id="btnCerrarSesion" class="btn btn-outline-danger btn-sm">
        <i class="fas fa-sign-out-alt"></i> Cerrar sesi√≥n
      </button>
    </div>
  </div>

  <!-- Formulario -->
  <form id="formPrestador" class="mb-4">
    <div class="row g-3">

      <div class="col-md-4">
        <label for="nombre" class="form-label">Nombre</label>
        <input type="text" class="form-control" id="nombre" required />
      </div>

      <div class="col-md-4">
        <label for="tipo" class="form-label">Tipo</label>
        <select class="form-control" id="tipo" name="tipo" required>
          <option value="">Seleccionar...</option>
          <option value="sanatorio">Sanatorio</option>
          <option value="clinica">Cl√≠nica</option>
          <option value="hospital">Hospital</option>
          <option value="laboratorio">Laboratorio</option>
          <option value="medico">M√©dico</option>
          <option value="psicologo">Psic√≥logo</option>
          <option value="nutricionista">Nutricionista</option>
          <option value="fisioterapeuta">Fisioterapeuta</option>
          <option value="otro">Otro</option>
        </select>
      </div>

      <div class="col-md-4">
        <label for="telefono" class="form-label">Tel√©fono</label>
        <input type="text" class="form-control" id="telefono">
      </div>

      <div class="col-md-4">
        <label for="direccion" class="form-label">Direcci√≥n</label>
        <input type="text" class="form-control" id="direccion">
      </div>

      <div class="col-md-4">
        <label for="departamento" class="form-label">Departamento</label>
        <select class="form-control" id="departamento" required>
          <option value="">Seleccionar...</option>
        </select>
      </div>

      <div class="col-md-4">
        <label for="localidad" class="form-label">Ciudad / Localidad</label>
        <select class="form-control" id="localidad" required>
          <option value="">Seleccionar un departamento primero...</option>
        </select>
      </div>

      <div class="col-md-4">
        <label for="especialidad" class="form-label">Especialidad</label>
        <select id="especialidad" class="form-select">
          <option value="">Seleccionar una especialidad...</option>
        </select>
      </div>

      <div class="col-md-4">
        <label for="id_madre">Instituci√≥n Madre (opcional)</label>
        <select id="id_madre" class="form-control">
          <option value="">-- Seleccionar --</option>
        </select>
      </div>

      <div class="col-md-4">
        <label for="es_institucion" class="form-label">¬øEs una instituci√≥n?</label>
        <select class="form-select" id="es_institucion">
          <option value="false">No</option>
          <option value="true">S√≠</option>
        </select>
      </div>

      <div class="col-12 d-flex justify-content-end">
        <button type="submit" class="btn btn-primary">Guardar Prestador</button>
      </div>

    </div>
  </form>

  <!-- Tabla -->
  <table class="table table-bordered table-striped" id="tablaPrestadores">
    <thead class="encabezado-verde">
      <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Tipo</th>
        <th>Tel√©fono</th>
        <th>Especialidad</th>
        <th>Localidad</th>
        <th>Departamento</th>
        <th>Es Instituci√≥n</th>
        <th>Instituci√≥n Madre</th>
        <th>Registrado por</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <!-- Se cargar√° din√°micamente -->
    </tbody>
  </table>
</div>

<!-- Scripts -->
<script src="./js/prestadores.js"></script>
<script>
  // Mostrar el nombre del usuario actual
  const usuarioActivo = JSON.parse(localStorage.getItem('usuario'));
  if (usuarioActivo) {
    document.getElementById('nombreUsuario').textContent = `üë§ ${usuarioActivo.nombre}`;
  }

  // Manejar el cierre de sesi√≥n
  document.getElementById('btnCerrarSesion').addEventListener('click', () => {
    if (confirm("¬øDeseas cerrar sesi√≥n?")) {
      localStorage.removeItem('usuario');
      window.location.href = "login.html";
    }
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const usuario = JSON.parse(localStorage.getItem('usuario'));
    if (usuario && usuario.nombre) {
      document.getElementById('nombreUsuario').textContent = `Bienvenido, ${usuario.nombre}`;
    }

    // Cargar localidades
    fetch('/api/localidades')
      .then(res => res.json())
      .then(data => {
        const selectCiudad = document.getElementById('localidad');
        data.forEach(localidad => {
          const option = document.createElement('option');
          option.value = localidad.nombre;
          option.text = localidad.nombre;
          selectCiudad.appendChild(option);
        });
      });

    // Cargar especialidades
    fetch('http://127.0.0.1:5000/api/especialidades')
      .then(response => response.json())
      .then(data => {
        const select = document.getElementById('especialidad');
        data.forEach(nombre => {
          const option = document.createElement('option');
          option.value = nombre;
          option.textContent = nombre;
          select.appendChild(option);
        });
      })
      .catch(error => console.error('Error al cargar especialidades:', error));
  });
</script>

</body>
</html>

